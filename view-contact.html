<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="script.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <link rel="stylesheet" href="styles.css">

    <script>

        var contactKey;

        function init() {
            webApp = window.Telegram.WebApp;
            if (webApp != null) {
                webApp.expand();
                const queryString = window.location.search;
                const urlParams = new URLSearchParams(queryString);
                contactKey = urlParams.get('key');
                if (contactKey) {
                    getContact();
                }
            }
        }

        function getContact() {
            log("Get stored key: " + contactKey);
            var request = webApp.CloudStorage.getItem(contactKey, onStoredKey);
        }

        function onStoredKey(error, value) {
            if (!error) {
                if (value.length == 0) {
                    log("no key found");
                } else {
                    fillData(value);
                    //createContactListItem(value);
                }
            } else {
                log(error);
            }
        }

        function fillData(value) {
            var item = JSON.parse(value);
            assignInnerHTML(item, "displayName");
            assignInnerHTML(item, "shortRemark");
            assignInnerHTML(item, "firstName");
            assignInnerHTML(item, "lastName");
            document.getElementById("gender").innerHTML = gendersList[item.gender];
            assignInnerHTML(item, "dateOfBirth");
            document.getElementById("placeOfBirth").innerHTML = countriesList[item.placeOfBirth];
            document.getElementById("nationality").innerHTML = nationalitiesList[item.nationality];
            assignInnerHTML(item, "occupation");
            assignInnerHTML(item, "company");
            document.getElementById("workStatus").innerHTML = item.workStatus;
            assignInnerHTML(item, "primaryPhone");
            assignInnerHTML(item, "primaryEmail");
            assignInnerHTML(item, "telegramAccount");
            assignInnerHTML(item, "description");
            document.getElementById("userpicImg").src = item.userpic;
        }

        function editContact() {
            showEditContactScreen(contactKey);
        }

        function shareContact() {
            alert("Sorry, sharing contacts is not available yet.");
        }

      //
  </script>
    
  </head>
  <body onload="init()">

    <div id="header" class="horizontal-block">
      <button class="back-button" onclick="showContactsListScreen()">←</button>
      <div class="title-label">View Contact</div>
      <button class="menu-button">≡</button>
    </div>

    <div id="viewContactScreen" class="viewContactScreen switchableDiv">
      <div class="Frame18" style="width: 100%; padding-top: 8px; padding-bottom: 8px; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
        <div class="DisplaySettings horizontal-container">
            <div class="userpicBlock" style="width:30%; justify-content: flex-start; align-items: flex-start; display: flex">
                <img id="userpicImg" class="userpicImg" style="width: 40px; height: 40px; background: #D9D9D9; border-radius: 4px"/>
            </div>
            <p id="displayName" style="width: 30%;"></p>
            <p id="shortRemark" style="width: 30%;"></p>
        </div>
        <div class="BasicPersonalData horizontal-container">
            <p id="firstName" style="width: 30%;"></p>
            <p id="lastName" style="width: 30%;"></p>
            <p id="gender" style="width: 30%;"></p>
        </div>
        <div class="BirthData horizontal-container">
            <p id="dateOfBirth" style="width: 30%;"></p>
            <p id="placeOfBirth" style="width: 30%;"></p>
            <p id="nationality" style="width: 30%;"></p>
        </div>
        <div class="OccupationData horizontal-container">
            <p id="occupation" style="width: 30%;"></p>
            <p id="company" style="width: 30%;"></p>
            <p id="workStatus" style="width: 30%;"></p>
        </div>

        <div class="ContactsData horizontal-container">
            <p id="primaryPhone" style="width: 30%;"></p>
            <p id="primaryEmail" style="width: 30%;"></p>
            <p id="telegramAccount" style="width: 30%;"></p>
        </div>

        <div class="Description horizontal-container">
            <p id="description" style="width: 100%;"></p>
        </div>
      </div>
    </div>

    <div class="horizontal-container bottom-container">
      <div class="bottom-block" style="width: 30%;">
        <button class="primary-button" onclick="showContactsListScreen()">Close</button>
      </div>
      <div class="bottom-block" style="width: 30%;">
        <button class="primary-button" onclick="editContact()">Edit</button>
      </div>
      <div class="bottom-block" style="width: 30%;">
        <button class="primary-button" onclick="shareContact()">Share</button>
      </div>
    </div>

    <div id="debugDiv" class="debugDiv" style="position: absolute; width: 100%; height: 100%; margin: 0px; padding: 0px;">
        <p id="debugText" class="debugText"></p>
    </div>

  </body>
</html>
